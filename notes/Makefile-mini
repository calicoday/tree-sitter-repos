# prelim makefile for simple demos, mostly from Using Parsers

VERSION := 0.6.3

# ABI versioning
SONAME_MAJOR := 0.20
SONAME_MINOR := 7

SHUNTLIB ?= /libtree-sitter.$(SONAME_MAJOR).$(SONAME_MINOR)
# SHUNTDIR ?= $(SHUNTLIB)/tree_sitter
SHUNTDIR ?= /tree_sitter.$(SONAME_MAJOR).$(SONAME_MINOR)/tree_sitter

# install directory layout
PREFIX ?= /usr/local
INCLUDEDIR ?= $(PREFIX)/include$(SHUNTDIR)
LIBDIR ?= $(PREFIX)/lib
PCLIBDIR ?= $(LIBDIR)/pkgconfig


json: using-parsers-json.c \
  '$(DESTDIR)$(LIBDIR)$(SHUNTLIB)' '$(DESTDIR)$(LIBDIR)'/libtree-sitter-json.a
	clang $^ -I$(INCLUDEDIR) -o using-parsers-json

shrub: shrub.c $(LOCLIBDIR)/libshrub.a
	clang $^ -I$(LOCINCLUDEDIR) -o shrub
# try dylib form???
# 	clang shrub.c ./libshrub.dylib -o test-json-parser





# do better!!!

all: shrub

# vs sys lib, include...
# LOCLIBDIR ?= ../libshrub-c/build/lib
LOCLIBDIR ?= ../libshrub-c/build
LOCINCLUDEDIR ?= ../libshrub-c/lib/include

# define default flags, and override to append mandatory flags
CFLAGS ?= -O3 -Wall -Wextra -Werror
override CFLAGS += -std=gnu99 -fPIC -Ilib/src -Ilib/include

json: using-parsers-json.c 

shrub: shrub.c $(LOCLIBDIR)/libshrub.a
	clang $^ -I$(LOCINCLUDEDIR) -o shrub
# try dylib form???
# 	clang shrub.c ./libshrub.dylib -o test-json-parser

# shrub: $(LOCLIBDIR)/libshrub.a
# 	clang shrub.c $^ -I$(LOCINCLUDEDIR) -o shrub
# # try dylib form???
# # 	clang shrub.c ./libshrub.dylib -o test-json-parser
# 
clean:
	rm -f shrub
# 	rm -f src/*.o shrub
	
# tidy:
# 	rm -f src/*.o
	
.PHONY: all install clean

